---
title: "WR_v4_deltaEstimators"
author: "FÃ¡tima S. Barreiro"
date: "November 17, 2020"
output: html_document
---

Load required libraries
```{r message=FALSE, warning=FALSE, paged.print=FALSE}
library(ggplot2)
library(cowplot)
library(ggrepel)
library(reshape2)
library(dplyr)
library(tidyverse)
library(data.table)
require(scales)
library(ggpubr)
library(tidyr)
library(PairedData)
library(gridExtra)
```

Open metadata and genomic metrics table
```{r}
data = read.csv("WR_TableS1_v5.csv", h=T, fill=T, stringsAsFactors=T, fileEncoding="latin1")
```




## GW Het

```{r}
datassHet = subset(data, lab_ID!='mwr_TG0450' & lab_ID!='mwr_TG0451' & lab_ID!='mwr_TG0456' & lab_ID!='mwr_TGF01')
```

```{r}
NWRpreH = datassHet[datassHet$time_window == "NWRpre",]
NWRpostH = datassHet[datassHet$time_window == "NWRpost",]
SWRpreH = datassHet[datassHet$time_window == "SWRpre",]
SWRpostH = datassHet[datassHet$time_window == "SWRpost",]

```


```{r}
dim(NWRpreH)
dim(NWRpostH)
dim(SWRpreH)
dim(SWRpostH)

```

### Median comparisons for GW Het

#### NWR
Group comparison
```{r}
wilcox.test(NWRpreH$gw_het_GL2_5x_ErTv, NWRpostH$gw_het_GL2_5x_ErTv, paired=F, alternative = "greater")
```

#### SWR
```{r}
wilcox.test(SWRpreH$gw_het_GL2_5x_ErTv, SWRpostH$gw_het_GL2_5x_ErTv, paired=F, alternative = "greater")
```

### Delta estimators for GW Het
Delta estimators
```{r}
datassHet$time_window=factor(datassHet$time_window,levels=c("NWRpre","NWRpost","SWRpre", "SWRpost"))
```

```{r}
datassHet %>%
  group_by(time_window) %>%
  #summarize(min=min(gw_het_GL2_5x_ErTv), max=max(gw_het_GL2_5x_ErTv), median=median(gw_het_GL2_5x_ErTv))
  summarize(median=median(gw_het_GL2_5x_ErTv))
  
```



###################################################

## RoH length and FRoH

```{r}
datassF = subset(data, lab_ID!='mwr_TG0450' & lab_ID!='mwr_TG0451' & lab_ID!='mwr_TG0456' & lab_ID!='mwr_TGF01' & lab_ID!='mwr_TG0452' & lab_ID!='mwr_TG0461' & lab_ID!='mwr_TGF02' & lab_ID!='mwr_TGF04')
```

```{r}
NWRpreF = datassF[datassF$time_window == "NWRpre",]
NWRpostF = datassF[datassF$time_window == "NWRpost",]
SWRpreF = datassF[datassF$time_window == "SWRpre",]
SWRpostF = datassF[datassF$time_window == "SWRpost",]

```

```{r}
dim(NWRpreF)
dim(NWRpostF)
dim(SWRpreF)
dim(SWRpostF)

```


### Median comparisons for FRoH

#### NWR
Group comparison
```{r}
wilcox.test(NWRpreF$Froh, NWRpostF$Froh, paired=F, alternative = "less")
```

#### SWR
```{r}
wilcox.test(SWRpreF$Froh, SWRpostF$Froh, paired=F, alternative = "less")
```



### Delta estimators for FRoH
Delta estimators
```{r}
datassF$time_window=factor(datassF$time_window, levels=c("NWRpre","NWRpost","SWRpre", "SWRpost"))
```

```{r}
datassF %>%
  group_by(time_window) %>%
  summarize(min=min(Froh), max=max(Froh), median=median(Froh))
```


### Median comparisons for average RoH length

#### NWR
Group comparison
```{r}
wilcox.test(NWRpreF$ave_RoH_len, NWRpostF$ave_RoH_len, paired=F, alternative = "less")
```

#### SWR
```{r}
wilcox.test(SWRpreF$ave_RoH_len, SWRpostF$ave_RoH_len, paired=F, alternative = "less")
```



### Delta estimators for FRoH
Delta estimators
```{r}
datassF$time_window=factor(datassF$time_window, levels=c("NWRpre","NWRpost","SWRpre", "SWRpost"))
```

```{r}
datassF %>%
  group_by(time_window) %>%
  summarize(min=min(ave_RoH_len), max=max(ave_RoH_len), median=median(ave_RoH_len))
```



### Median comparisons for maximum RoH length

#### NWR
Group comparison
```{r}
wilcox.test(NWRpreF$max_RoH_len, NWRpostF$max_RoH_len, paired=F, alternative = "less")
```

#### SWR
```{r}
wilcox.test(SWRpreF$max_RoH_len, SWRpostF$max_RoH_len, paired=F, alternative = "less")
```



### Delta estimators for FRoH
Delta estimators
```{r}
datassF$time_window=factor(datassF$time_window, levels=c("NWRpre","NWRpost","SWRpre", "SWRpost"))
```

```{r}
datassF %>%
  group_by(time_window) %>%
  summarize(min=min(max_RoH_len), max=max(max_RoH_len), median=median(max_RoH_len))
```



#################################################################################################################################


## Toy code for preliminary tests


### Statistical comparison of gw_het median between pre- and post-bottleneck samples for each subspecies

```{r}
ggplot(data5x, aes(gw_het_GL2_3x_ErTv, group=time_window, fill=time_window)) + geom_histogram(alpha=0.5, binwidth=0.000005, position = "identity") #+ geom_density(alpha=0.2)
```



Making a dataframe per group (subspecies and time window)
```{r}
nwr1_5x = data5x[data5x$time_window == "NWR1",]
nwr2_5x = data5x[data5x$time_window == "NWR2",]
swr1_5x = data5x[data5x$time_window == "SWR1",]
swr2_5x = data5x[data5x$time_window == "SWR2",]
```


Comparison NWR1-NWR2. Testing whether Het in NWR2 is significantly smaller than that of NWR1
```{r}
# the two-sided test reports if there is a significant difference between the distributions, on both sides of the distribution
wilcox.test(nwr1_5x$gw_het_GL2_3x_ErTv, nwr2_5x$gw_het_GL2_3x_ErTv, paired = F, alternative=c("two.sided"))

# the left test reports if the distribution of Het of NWR1 is to the left of that of NWR2 (i.e. NWR1 smaller than NWR2)
wilcox.test(nwr1_5x$gw_het_GL2_3x_ErTv, nwr2_5x$gw_het_GL2_3x_ErTv, paired = F, alternative=c("less")) 

# the right test reports is NWR1 is to the right (larger) than NWR2 Het distribution
wilcox.test(nwr1_5x$gw_het_GL2_3x_ErTv, nwr2_5x$gw_het_GL2_3x_ErTv, paired = F, alternative=c("greater"))
```


Comparison SWR1-SWR2
```{r}
# the two-sided test reports if there is a significant difference between the distributions, on both sides of the distribution
wilcox.test(swr1_5x$gw_het_GL2_3x_ErTv, swr2_5x$gw_het_GL2_3x_ErTv, paired = F, alternative=c("two.sided"))

# the left test reports if the distribution of Het of SWR1 is to the left of that of SWR2 (i.e. SWR1 smaller than SWR2)
wilcox.test(swr1_5x$gw_het_GL2_3x_ErTv, swr2_5x$gw_het_GL2_3x_ErTv, paired = F, alternative=c("less"))

# the right test reports is SWR1 is to the right (larger) than SWR2 Het distribution
wilcox.test(swr1_5x$gw_het_GL2_3x_ErTv, swr2_5x$gw_het_GL2_3x_ErTv, paired = F, alternative=c("greater"))
#wilcox.test(swr2_5x$gw_het_GL2_3x_ErTv, swr1_5x$gw_het_GL2_3x_ErTv, paired = F, alternative=c("less")) #equivalent test
```

##################

#### Statistical tests for the whole sample set (n=52)

Making a dataframe per group (subspecies and time window)
```{r}
nwr1 = data[data$time_window == "NWR1",]
nwr2 = data[data$time_window == "NWR2",]
swr1 = data[data$time_window == "SWR1",]
swr2 = data[data$time_window == "SWR2",]
```


Comparison NWR1-NWR2. Testing whether Het in NWR2 is significantly smaller than that of NWR1
```{r}
# the two-sided test reports if there is a significant difference between the distributions, on both sides of the distribution
wilcox.test(nwr1$gw_het_GL2_3x_ErTv, nwr2$gw_het_GL2_3x_ErTv, paired = F, alternative=c("two.sided"))

# the left test reports if the distribution of Het of NWR1 is to the left of that of NWR2 (i.e. NWR1 smaller than NWR2)
wilcox.test(nwr1$gw_het_GL2_3x_ErTv, nwr2$gw_het_GL2_3x_ErTv, paired = F, alternative=c("less")) 

# the right test reports is NWR1 is to the right (larger) than NWR2 Het distribution
wilcox.test(nwr1$gw_het_GL2_3x_ErTv, nwr2$gw_het_GL2_3x_ErTv, paired = F, alternative=c("greater"))
```


Comparison SWR1-SWR2
```{r}
# the two-sided test reports if there is a significant difference between the distributions, on both sides of the distribution
wilcox.test(swr1$gw_het_GL2_3x_ErTv, swr2$gw_het_GL2_3x_ErTv, paired = F, alternative=c("two.sided"))

# the left test reports if the distribution of Het of SWR1 is to the left of that of SWR2 (i.e. SWR1 smaller than SWR2)
wilcox.test(swr1$gw_het_GL2_3x_ErTv, swr2$gw_het_GL2_3x_ErTv, paired = F, alternative=c("less"))

# the right test reports is SWR1 is to the right (larger) than SWR2 Het distribution
wilcox.test(swr1$gw_het_GL2_3x_ErTv, swr2$gw_het_GL2_3x_ErTv, paired = F, alternative=c("greater"))
#wilcox.test(swr2_5x$gw_het_GL2_3x_ErTv, swr1_5x$gw_het_GL2_3x_ErTv, paired = F, alternative=c("less")) #equivalent test
```




















