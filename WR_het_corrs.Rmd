---
title: "Het correlations"
author: "Fátima S. Barreiro"
date: "July 10, 2020"
output: html_document
---




Load required libraries
```{r message=FALSE, warning=FALSE, paged.print=FALSE}
library(ggplot2)
library(cowplot)
library(ggrepel)
library(reshape2)
library(dplyr)
library(tidyverse)
library(data.table)
require(scales)
library(ggpubr)
library(tidyr)
library(PairedData)
library(gridExtra)
```


Reading in file containing metadata and genomic diversity metrics 
```{r}
data = read.csv("WR_TableS1_v5.csv", h=T, fill=T, stringsAsFactors=T, fileEncoding="latin1")
```




### Correlations between different estimates of heterozygosity


```{r}
C1 = ggscatter(data, x = "gw_het_GL1_raw", y = "gw_het_GL1_corrected", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") + ggtitle("GWhet with GL1 uncorrected vs GWhet with GL1 corrected")

C2 = ggscatter(data, x = "gw_het_GL1_raw", y = "gw_het_GL2", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") + ggtitle("GWhet with GL1 uncorrected vs GWhet with GL2")

C3 = ggscatter(data, x = "gw_het_GL1_raw", y = "gw_het_GL2", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") + ggtitle("GWhet with GL1 corrected vs GWhet with GL2")

C4 = ggscatter(data, x = "gw_het_GL2_3x", y = "gw_het_GL2", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") + ggtitle("GWhet with GL2 and 3x min VS GL2")

C5 = ggscatter(data, x = "gw_het_GL2_3x", y = "gw_het_GL2_5x", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") + ggtitle("GWhet with GL2 and 3x min VS GL2 and 5x min")

C6 = ggscatter(data, x = "gw_het_GL2_3x", y = "gw_het_GL1_corrected", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") + ggtitle("GWhet with GL2 and 3x min VS GL1-corrected")



```


```{r}
C4
C5
C6
```


```{r eval=FALSE, include=FALSE}
# pdf("WR_Het_GLcorrelations.pdf", height=7, useDingbats = F)
# plot_grid(C1, C2, C3, nrow=3, ncol=1)
# dev.off
```



### Differences between different estimates of het across samples

```{r}
dataH = data[, c("lab_ID", "gw_het_GL1_raw", "gw_het_GL1_corrected", "gw_het_GL2", "gw_het_GL2_3x", "gw_het_GL2_5x", "gw_het_GL2_3x_ErTv", "gw_het_GL2_5x_ErTv" )]
dataM = reshape2::melt(dataH, id.vars=c("lab_ID"))
head(dataM)
```

```{r}
Hs = ggplot(dataM, aes(lab_ID, value, colour=variable, shape=variable)) + geom_point() + theme_bw() +
  scale_shape_manual(values=c(15, 16, 17, 18, 19, 20, 21)) +
  theme(axis.text.x=element_text(angle=80, hjust=1), legend.position = "top", legend.title=element_blank()) + 
  guides(colour=guide_legend(ncol=2)) +
  ylab("Het estimate")

Hs
```

```{r}
# pdf("WR_GWhet_estimates.pdf", height=5, useDingbats = F)
# Hs
# dev.off
```



### Correlations between het and depth of coverage

```{r}
D1 = ggscatter(data, x = "depth_of_coverage", y = "gw_het_GL1_raw", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") + ggtitle("DoC vs GWhet GL1 uncorrected")

D2 = ggscatter(data, x = "depth_of_coverage", y = "gw_het_GL1_corrected", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") + ggtitle("DoC vs GWhet GL1 corrected")

D3 = ggscatter(data, x = "depth_of_coverage", y = "gw_het_GL2", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") + ggtitle("DoC vs GWhet GL2")

D4 = ggscatter(data, x = "depth_of_coverage", y = "gw_het_GL2_3x", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") + ggtitle("DoC vs GWhet GL2-3x minDoC")

D5 = ggscatter(data, x = "depth_of_coverage", y = "gw_het_GL2_5x", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") + ggtitle("DoC vs GWhet GL2-5x minDoC")


```


```{r}
D1
D2
D3
D4
D5
```


```{r}
# pdf("WR_HetVsDoc.pdf", height=8, width=9, useDingbats = F)
# plot_grid(D1, D2, D3, D4, D5, nrow=3, ncol=2, labels=c('A','B','C','D', 'E'))
# dev.off
```


```{r}
E1 = ggscatter(data, x = "X5â..CtoT_damage", y = "gw_het_GL1_raw", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") + ggtitle("Damage vs GWhet GL1 uncorrected")

E2 = ggscatter(data, x = "X5â..CtoT_damage", y = "gw_het_GL1_corrected", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") + ggtitle("Damage vs GWhet GL1 corrected")

E3 = ggscatter(data, x = "X5â..CtoT_damage", y = "gw_het_GL2", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") + ggtitle("Damage vs GWhet GL2")

E4 = ggscatter(data, x = "X5â..CtoT_damage", y = "gw_het_GL2_3x", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") + ggtitle("Damage vs GWhet GL2-3x minDoC")

E5 = ggscatter(data, x = "X5â..CtoT_damage", y = "gw_het_GL2_5x", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson") + ggtitle("Damage vs GWhet GL2-5x minDoC")

```


```{r}
E1
E2
E3
E4
E5
```



```{r eval=FALSE, include=FALSE}
# pdf("WR_HetVsDamage.pdf", height=8, width=9, useDingbats = F)
# plot_grid(E1, E2, E3, E4, E5, nrow=3, ncol=2, labels=c('A','B','C','D', 'E'))
# dev.off
```


###############################################################################################################################



## Depth versus het across the 4 downsampling experiments


Read in data table
```{r}
DSdataAll = read.csv("GWhet_DSexperiments0-1-2-3.csv", h=T, fill=T, stringsAsFactors=T, fileEncoding="latin1")
```

Set the order of the experiments for plotting
```{r}
DSdataAll$doc_filter <- factor(DSdataAll$doc_filter, levels=c("GL1-no_filter","GL2-no_filter","GL2-3x_filter","GL2-5x_filter"))
```

Visualise
```{r}
DS = ggplot(data=DSdataAll, aes(depth, het, colour=sample)) + geom_point(aes(shape=depth_category)) + geom_line() + theme_bw() +
  xlim(limits=c(0,23)) + 
  labs(x="Depth of coverage", y="Genome-wide heterozygosity", shape="Depth category", colour="Sample") +
  facet_wrap(~ doc_filter, nrow=2, ncol=2)

DS
```


Find the colours in the default palette used by ggplot
```{r}
pdata = ggplot_build(DS)$data[[1]]

levels(as.factor(pdata$colour))

```

Assign labels and colour codes to the 13 samples using the sample name instead of the lab ID
```{r}
DS = DS + scale_colour_manual(values=c("#00ACFC", "#00BBDA", "#00BE70", "#00C1AB", "#24B700", "#8B93FF", "#8CAB00", "#BE9C00", "#D575FE", "#E18A00", "#F8766D", "#F962DD", "#FF65AC"), 
                              labels=c("ZA1869.1", "CD1912.2", "CD1911.1", "SD1905.4", "ZA-un.1", "ZA1845.2", "UG1905.2", "cap2008.1", "cap2011.3", "ZA1968.1", "ZA1958.1", "SD1973.1", "SD1972.3")) 

DS
```



```{r}
pdf("WR_v4_FigS6_DSexp.pdf", height=5, useDingbats = F)
DS
dev.off
```




































